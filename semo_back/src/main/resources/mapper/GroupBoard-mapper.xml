<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.or.semo.groupBoard.model.dao.GroupBoardDao">
	<select id="totalCount" resultType="int">
		select count(*) from gr_board where gr_board_state=1
	</select>
	
	<select id="selectgroupBoardList" resultType="groupBoard">
		select * from
			(select rownum as rnum, b.* from
			(select 
			    gr_board_no,
			    gr_board_title,
			    gr_board_writer,
			    member_id,
			    to_char(gr_board_date, 'yyyy-mm-dd') as gr_board_date
			from gr_board
			join member on (gr_board_writer = member_no)
			where gr_board_state = 1 and group_no = #{groupNo}
			order by 1 desc) b)
		where rnum between #{pi.start} and #{pi.end}
	</select>
	<insert id="insertGroupBoard">
		insert into gr_board values(gr_board_seq.nextval, #{grBoardTitle}, #{grBoardContent}, sysdate, #{grBoardWriter}, #{groupNo}, 1)
		<selectKey resultType="int" keyProperty="grBoardNo" order="AFTER">
			select max(gr_board_no) from gr_board
		</selectKey>
	</insert>
	<select id="selectOneGroupBoard" resultType="groupBoard">
		select 
			gr_board_no, gr_board_title, gr_board_content, to_char(gr_board_date,'yyyy-mm-dd') as gr_board_date, gr_board_writer, member_name, group_no, gr_board_state
		from gr_board 
		join member on(gr_board_writer = member_no)
		where gr_board_no = #{grBoardNo}
	</select>
	<update id="updateGroupBoard">
		update gr_board set 
			gr_board_title = #{grBoardTitle}, gr_board_content = #{grBoardContent}
		where gr_board_no = #{grBoardNo}
	</update>
	<delete id="deleteGroupBoard">
		delete from gr_board where gr_board_no = #{grBoardNo}
	</delete>
</mapper>